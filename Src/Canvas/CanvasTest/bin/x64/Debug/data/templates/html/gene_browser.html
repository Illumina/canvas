<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <title>
      {{ control }} vs {{ comparison }} 
    </title>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load('visualization', '1.1', {packages: ['controls']});
    </script>
    <script src="file:{{ prefix }}_genes.json"></script>
    <script type="text/javascript">

      function drawVisualization() {
        // Prepare the data
        var pageSize = 10;
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Gene');
        data.addColumn('string', 'Gene Name');
        data.addColumn('string', 'Status');
        data.addColumn('number', 'Mean Count');
        data.addColumn('number', 'log2(Fold Change)');
        data.addColumn('number', 'Std. err. log2(Fold Change)');
        data.addColumn('number', '|log2(Fold Change)|');
        data.addColumn('number', 'q value');
        data.addColumn('string', 'Significant');

        for(var rowIdx = 0; rowIdx < DiffData.length; rowIdx++){
                data.addRow(DiffData[rowIdx]);
        }


        // Define slider for abs_log_ratio
        var lrSlider = new google.visualization.ControlWrapper({
          'controlType': 'NumberRangeFilter',
          'containerId': 'control1',
          'options': {
            'filterColumnLabel': '|log2(Fold Change)|',
            'ui': {'labelStacking': 'horizontal'}
          }
        });

        //// Define slider for qvalue
        //var pSlider = new google.visualization.ControlWrapper({
        //  'controlType': 'NumberRangeFilter',
        //  'containerId': 'control2',
        //  'options': {
        //    'filterColumnLabel': 'q value',
        //    'ui': {'labelStacking': 'horizontal',
        //           'ticks': 100,
        //           'unitIncrement': 0.01,
        //         'label' : ''}
        //  }
        //});


        // Define a category picker control for status
        var statusPicker = new google.visualization.ControlWrapper({
          'controlType': 'CategoryFilter',
          'containerId': 'control4',
          'options': {
            'filterColumnLabel': 'Status',
            'ui': {
            'labelStacking': 'vertical',
              'allowTyping': false,
              'allowMultiple': false
            }
          }
        });

        // Define a category picker control for significance
        var sigPicker = new google.visualization.ControlWrapper({
          'controlType': 'CategoryFilter',
          'containerId': 'control6',
          'options': {
            'filterColumnLabel': 'Significant',
            'ui': {
            'labelStacking': 'vertical',
              'allowTyping': false,
              'allowMultiple': false
            }
          }
          });

        // Define a StringFilter control for the 'gene' column
          var geneFilter = new google.visualization.ControlWrapper({
            'controlType': 'StringFilter',
            'containerId': 'control5',
            'options': {
                'filterColumnLabel': 'Gene',
                'ui': {
                        'labelStacking': 'vertical'
                }
            }
          });


        // Define a scatter chart of FPKM values
        var scatter = new google.visualization.ChartWrapper({
          'chartType': 'ScatterChart',
          'containerId': 'chart1',
          'options': {
            'width': 550,
            'height': 350,
            'chartArea' : {
                'width' : "80%",
                'height' : "80%", },
            'pointSize' : 1,
            'hAxis' : {
                'title' : 'Mean Count',
                'minValue' : 1,
                'maxValue' : 100,
                'logScale' : true,
                'viewWindow' : { 'min' : 1 },
                        },
            'vAxis' : {
                'title' : 'log2(Fold Change)',
                'minValue' : -2,
                'maxValue' : 2,
            },
            'tooltip' : {
            	'trigger' : 'none'
            },
            'legend' : {
            	'position' : 'none'
            }
          },
          'view': {'columns': [3, 4]}
        });

        // Define a table
        var table = new google.visualization.ChartWrapper({
          'chartType': 'Table',
          'containerId': 'chart2',
          'options': {
            'allowHtml' : true,
            'page' : 'enable',
            'pageSize' : pageSize 
          },
          'view' : {'columns': [0,1,2,3,4,5,7,8]}
        });


        google.visualization.events.addListener(scatter, 'select', function(){
                var targetRow = scatter.getChart().getSelection()[0].row;
                var targetPage = Math.floor(targetRow / pageSize);
                table.setOption('startPage', targetPage);
                table.draw();
                table.getChart().setSelection([{row:targetRow}]);
                });

        google.visualization.events.addListener(table, 'select', function(){
                scatter.getChart().setSelection(table.getChart().getSelection());
        });





        // Create a dashboard
        new google.visualization.Dashboard(document.getElementById('dashboard')).
            // Establish bindings, declaring the both the slider and the category
            // picker will drive both charts.
            bind([geneFilter, lrSlider, statusPicker, sigPicker], [scatter, table]).
            //bind([geneFilter, lrSlider, pSlider,statusPicker], [scatter, table]).
            // Draw the entire dashboard.
            draw(data);
      }


      google.setOnLoadCallback(drawVisualization);
    </script>
  </head>
  <body style="font-family: Arial;border: 0 none;">
    <p style="text-align:center;font-size:50px;"> {{ control }} vs {{ comparison }}</p>
    <div id="dashboard">
		<div>
			<div>
				<table width="100%">
					<tr style='vertical-align: top'>
						<td style='width: 250px; font-size: 0.9em;'>
                            <p style="text-align:left;font-size:20px">Filters</p>
                            <div id="control4"></div></br>
                            <div id="control6"></div></br>
							<div id="control1"></div></br>
                            <div id="control5"></div></br>
						</td>
						<td align="center">
							<div id="chart1"></div>
						</td>
					</tr>
				</table>
			</div>
		</div>
        <p style="padding-bottom: 1cm;"> </p>
		<div id="chart2"></div>
    </div>
    <p style="text-align:left;font-size:20px"><a href="{{ prefix }}_ma.pdf" >M/A Plot</a></p>
    <p style="text-align:left;font-size:20px"><a href="{{ prefix }}_disp.pdf" >Dispersion Plots</a></p>
    <p style="text-align:left;font-size:20px"><a href="{{ prefix }}_heatmap.pdf" >Gene Heatmap</a></p>
  </body>
</html>
