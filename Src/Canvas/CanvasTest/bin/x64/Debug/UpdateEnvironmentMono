#!/usr/bin/env bash
#script must be in the parent directory of packages directory for this to work
SCRIPT_DIR="$( dirname "$( readlink -f "${BASH_SOURCE[0]}" )" )"
PKG_DIR=${SCRIPT_DIR}/../packages
MONO_DIRNAME=$1
PYTHON_DIRNAME=$2

# default to mono 4.0.2:
if [ -z "${MONO_DIRNAME}" ]; then
    MONO_DIRNAME=4.0.2
fi

MONO_DIR_PATHS=""
MONO_DIR_PATH=$( readlink -f "${PKG_DIR}/mono-${MONO_DIRNAME}" )
if [ ! -d "${MONO_DIR_PATH}" ]; then
       MONO_DIR_PATHS="${MONO_DIR_PATH} ${MONO_DIR_PATHS}"
       MONO_DIR_PATH=$( readlink -f "${PKG_DIR}/${MONO_DIRNAME}" )
fi
if [ ! -d "${MONO_DIR_PATH}" ]; then
       MONO_DIR_PATHS="${MONO_DIR_PATH} ${MONO_DIR_PATHS}"
       MONO_DIR_PATH=$( readlink -f "${MONO_DIRNAME}" )
fi
if [ ! -d "${MONO_DIR_PATH}" ]; then
	MONO_DIR_PATHS="${MONO_DIR_PATH} ${MONO_DIR_PATHS}"
	echo "Could not find mono directory as absolute or relative path. Checked these paths: ${MONO_DIR_PATHS}"
	return 1
fi
PKG_DIR=$( readlink -f "${MONO_DIR_PATH}/.." )
if [ -e "${SGE_ROOT:-}/util/arch" ]; then
	ARCH=$(${SGE_ROOT:-}/util/arch)
	export PATH=${SGE_ROOT:-}/bin/${ARCH:-}:${PATH:-}
	export LD_LIBRARY_PATH=${SGE_ROOT:-}/lib/${ARCH:-}:${LD_LIBRARY_PATH:-}
fi

# default to python 2.7:
if [ -z "${PYTHON_DIRNAME}" ]; then
    PYTHON_DIRNAME=2.7
fi
PYTHON_DIR_PATH=$( readlink -f "${PYTHON_DIRNAME}" )
if [ ! -d "${PYTHON_DIR_PATH}" ]; then       
       PYTHON_DIR_PATH=$( readlink -f "${PKG_DIR}/python-${PYTHON_DIRNAME}" )
fi
if [ -d "${PYTHON_DIR_PATH}" ]; then
    export PATH=${PYTHON_DIRNAME}/bin:$PATH
else
	echo "Could not find python directory as absolute or relative path: ${PYTHON_DIRNAME} ${PYTHON_DIR_PATH}" 1>&2
fi

export PATH=/illumina/thirdparty/gdb/el6/gdb-7.8/bin:/illumina/thirdparty/gdb/gdb-7.8/bin:${MONO_DIR_PATH}/bin:${PKG_DIR}/jdk1.6.0_32/bin:${PKG_DIR}/TEE-CLC-10.0.0:${PKG_DIR}/bin:${PATH:-}
export LD_LIBRARY_PATH=${MONO_DIR_PATH}/lib64:${PKG_DIR}/lib64:$PKG_DIR/lib:${PKG_DIR}/boost-1.49.0/lib:${PKG_DIR}/boost-1.54.0/lib:${LD_LIBRARY_PATH:-}
export LD_RUN_PATH=${LD_LIBRARY_PATH:-}
export PKG_CONFIG_PATH=${MONO_DIR_PATH}/lib64/pkgconfig:${PKG_DIR}/lib64/pkgconfig:${PKG_CONFIG_PATH:-}
export MONO_ENV_OPTIONS="${ISIS_DEBUG_MONO:-} --gc=sgen"

#these are needed when mono-sgen is relocated to a different directory
export MONO_GAC_PREFIX=${MONO_DIR_PATH}
export MONO_PATH=${MONO_DIR_PATH}/lib/mono/4.5:${MONO_DIR_PATH}/lib/mono/4.0:${MONO_DIR_PATH}/lib/mono/3.5:${MONO_DIR_PATH}/lib/mono/2.0:${MONO_DIR_PATH}/lib/mono/compat-2.0
export MONO_CONFIG=${MONO_DIR_PATH}/etc/mono/config
export MONO_CFG_DIR=${MONO_DIR_PATH}/etc
export C_INCLUDE_PATH=${MONO_DIR_PATH}/include
export ACLOCAL_PATH=${MONO_DIR_PATH}/share/aclocal
export FONTCONFIG_PATH=${PKG_DIR}/etc/fonts
export XDG_DATA_HOME=${PKG_DIR}/etc/fonts
export MONO_REGISTRY_PATH=~/.mono/registry

echo "\$PATH:"
echo $PATH
echo "\$LD_LIBRARY_PATH:"
echo $LD_LIBRARY_PATH

echo "Using mono:"
mono --version
echo ""
